<div class="company-orders">
  <div class="title-block">Orders</div>

  <ng-container *ngIf="dataSource.data.length; else noResults">
    <div class="table-wrap">
      <table
        mat-table
        matSort
        class="table"
        multiTemplateDataRows
        [dataSource]="dataSource"
        (matSortChange)="sortData($event)">
        <ng-container matColumnDef="empty">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element"></td>
        </ng-container>
        <ng-container matColumnDef="id">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>Order</th>
          <td mat-cell *matCellDef="let element">
            <a class="hover" [routerLink]="generalUrl + '/order/' + element.id">
              #{{ element.id }}
            </a>
          </td>
        </ng-container>

        <ng-container matColumnDef="accepted">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>Accepted</th>
          <td mat-cell *matCellDef="let element">
            {{ element.accepted | date: 'dd/MM/YY' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="totalPrice">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>Total price</th>
          <td mat-cell *matCellDef="let element">
            {{ element.totalPrice | currency }}
          </td>
        </ng-container>

        <ng-container matColumnDef="customer">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>Username</th>
          <td mat-cell *matCellDef="let element">
            {{ element.customer }}
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let element">
            <span class="status-label" [ngClass]="toKebabCase(element.status)">
              {{ element.status }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="expand">
          <th mat-header-cell *matHeaderCellDef aria-label="row actions">
            &nbsp;
          </th>
          <td mat-cell *matCellDef="let element">
            <img
              class="arrow"
              src="./assets/images/icons/arrow-down.svg"
              [class.open]="isExpanded(element)"
              alt="Expand" />
          </td>
        </ng-container>

        <ng-container matColumnDef="expandedDetail">
          <td
            mat-cell
            *matCellDef="let element"
            [attr.colspan]="displayedColumns.length">
            <div
              class="expanded_details"
              [@detailExpand]="isExpanded(element) ? 'expanded' : 'collapsed'">
              <table class="table jobs-table">
                <tr class="table__header">
                  <th></th>
                  <th>Job number</th>
                  <th>Type of print</th>
                  <th>Quantity</th>
                  <th>Accepted</th>
                  <th>Price</th>
                  <th>Job Status</th>
                  <th></th>
                </tr>
                <tr
                  *ngFor="let job of element.jobs"
                  class="table__row"
                  (mouseup)="goToDetailsPage($event, element.id, './order')">
                  <td class="td_icons">
                    <img
                      *ngIf="job.errorArtwork"
                      class="icon"
                      src="./assets/images/icons/warning-red.svg"
                      [tooltip]="'Artwork error'"
                      alt="Error" />
                    <img
                      class="icon icon-product"
                      [src]="job.productIcon"
                      [tooltip]="job.productName"
                      alt="Icon" />
                  </td>
                  <td>{{ job.id }}</td>
                  <td>{{ job.productName }}</td>
                  <td>{{ numberMask(job.quantity) }}</td>
                  <td>{{ job.accepted | date: 'dd/MM/YY' }}</td>
                  <td>{{ job.price | currency }}</td>
                  <td>
                    <span
                      class="status-label"
                      [ngClass]="toKebabCase(job.status)">
                      {{ job.status }}
                    </span>
                  </td>
                  <td></td>
                </tr>
              </table>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          [ngClass]="{
            selected: selection.isSelected(row.id),
            open: isExpanded(row),
            last: dataSource.data[dataSource.data.length - 1] === row
          }"
          (click)="setExpandedElement($event, row)"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: ['expandedDetail']"
          class="expanded-row"></tr>
      </table>

      <mat-paginator
        *ngIf="isDisplayPaginator"
        [length]="totalItems"
        [pageSize]="params.perPage"
        [pageSizeOptions]="[5, 10, 20]"
        [pageIndex]="params.currentPage - 1"
        (page)="onChangePage($event)"></mat-paginator>
    </div>
  </ng-container>

  <ng-template #noResults>
    <app-no-results
      [noResultsText]="'You don\'t have orders yet'"></app-no-results>
  </ng-template>
</div>
